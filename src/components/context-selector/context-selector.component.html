<div class="relative w-full">
  <!-- Selector button -->
  <button (click)="toggleDropdown()"
          class="flex items-center justify-between w-full p-3 bg-gray-700 text-white rounded-md transition-colors duration-200 hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-gray-800">
    <div class="flex flex-col items-start">
      <span class="text-xs font-medium text-gray-400">Context</span>
      <span class="text-base">{{ propertyService.currentContextName() }}</span>
    </div>
    <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
    </svg>
  </button>

  <!-- Dropdown panel -->
  @if (isDropdownOpen()) {
    <div class="absolute z-20 mt-1 w-60 bg-white shadow-lg rounded-md border border-gray-200">
      <!-- Search input -->
      <div class="p-2 border-b border-gray-200">
        <div class="relative">
          <input [formControl]="searchTerm"
                 type="text"
                 placeholder="Search"
                 class="block w-full pl-8 pr-3 py-2 text-sm text-gray-900 border border-gray-300 rounded-md focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                 (click)="$event.stopPropagation()"> <!-- Prevent closing dropdown when clicking search -->
          <svg class="absolute left-2 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
        </div>
      </div>

      <!-- Context items list -->
      <ul class="py-1 max-h-60 overflow-y-auto">
        @if (filteredContextItems().length === 0) {
          <li class="px-3 py-2 text-sm text-gray-500">No results found.</li>
        }
        @for (item of filteredContextItems(); track item.id) {
          <li (click)="selectContext(item)"
              class="flex items-center justify-between px-3 py-2 cursor-pointer hover:bg-blue-50 text-gray-900 text-sm">
            <div class="flex flex-col">
              <span class="font-medium">{{ item.name }}</span>
              @if (item.subtext) {
                <span class="text-xs text-gray-500">{{ item.subtext }}</span>
              }
            </div>
            @if (propertyService.selectedContextId() === item.id) {
              <svg class="w-4 h-4 text-blue-600" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
              </svg>
            }
          </li>
        }
      </ul>
    </div>
  }
</div>
